<Window
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  Title="Genesys Cloud Extension Audit"
  Height="820"
  Width="1250"
  WindowStartupLocation="CenterScreen"
  Background="#F6F7F9">
  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <Border Grid.Row="0" Background="White" CornerRadius="6" Padding="12" BorderBrush="#DADDE2" BorderThickness="1">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Grid.Column="0" FontSize="16" FontWeight="SemiBold" Foreground="#1A1D21" Text="Extension Audit &amp; Repair"/>

        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
          <Button x:Name="BtnOpenOut" Margin="0,0,8,0" Padding="10,6" MinWidth="90" Content="Open Out"/>
          <Button x:Name="BtnOpenLog" Margin="0,0,8,0" Padding="10,6" MinWidth="90" Content="Open Log"/>
          <Button x:Name="BtnClear" Padding="10,6" MinWidth="90" Content="Clear"/>
        </StackPanel>

        <Grid Grid.Row="1" Grid.ColumnSpan="2" Margin="0,12,0,0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Foreground="#4B5563" Text="API Base URI"/>
          <TextBox x:Name="TxtApiBaseUri" Grid.Row="0" Grid.Column="1" Margin="10,0,0,0" Height="28"/>

          <CheckBox x:Name="ChkIncludeInactive" Grid.Row="0" Grid.Column="2" Margin="10,0,0,0" VerticalAlignment="Center" Content="Include inactive users"/>

          <Button x:Name="BtnBuildContext" Grid.Row="0" Grid.Column="3" Margin="12,0,0,0" Padding="12,6" MinWidth="130" Content="Build Context"/>

          <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,10,0,0" VerticalAlignment="Center" Foreground="#4B5563" Text="Access Token"/>
          <PasswordBox x:Name="PwdToken" Grid.Row="1" Grid.Column="1" Margin="10,10,0,0" Height="28"/>

          <CheckBox x:Name="ChkUseEnvToken" Grid.Row="1" Grid.Column="2" Margin="10,10,0,0" VerticalAlignment="Center" Content="Use $env:GC_ACCESS_TOKEN"/>
        </Grid>

        <TextBlock x:Name="TxtContext" Grid.Row="2" Grid.ColumnSpan="2" Margin="0,10,0,0" Foreground="#374151" TextWrapping="Wrap"/>
      </Grid>
    </Border>

    <Border Grid.Row="1" Background="White" CornerRadius="6" Padding="12" BorderBrush="#DADDE2" BorderThickness="1" Margin="0,12,0,12">
      <TabControl x:Name="Tabs" Background="White" BorderThickness="0">
        <TabItem Header="Dry Run">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
              <Button x:Name="BtnDryRun" Padding="12,6" MinWidth="140" Content="Generate Dry Run"/>
              <Button x:Name="BtnDryRunExport" Margin="10,0,0,0" Padding="12,6" MinWidth="140" Content="Export CSVs"/>
            </StackPanel>

            <TextBox x:Name="TxtDryRunSummary" Grid.Row="1" Margin="0,10,0,10" Height="90" IsReadOnly="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>

            <DataGrid x:Name="GridDryRun" Grid.Row="2" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Action" Binding="{Binding Action}" Width="170"/>
                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="160"/>
                <DataGridTextColumn Header="User" Binding="{Binding User}" Width="260"/>
                <DataGridTextColumn Header="Profile Extension" Binding="{Binding ProfileExtension}" Width="120"/>
                <DataGridTextColumn Header="Before Owner" Binding="{Binding Before_ExtOwner}" Width="240"/>
                <DataGridTextColumn Header="After / Expected" Binding="{Binding After_Expected}" Width="*"/>
                <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="260"/>
              </DataGrid.Columns>
            </DataGrid>
          </Grid>
        </TabItem>

        <TabItem Header="Missing Assignments">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
              <Button x:Name="BtnMissing" Padding="12,6" MinWidth="170" Content="Refresh Missing"/>
              <Button x:Name="BtnMissingExport" Margin="10,0,0,0" Padding="12,6" MinWidth="140" Content="Export CSV"/>
            </StackPanel>

            <TextBlock x:Name="TxtMissingSummary" Grid.Row="1" Margin="0,10,0,10" Foreground="#374151" TextWrapping="Wrap"/>

            <DataGrid x:Name="GridMissing" Grid.Row="2" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Profile Extension" Binding="{Binding ProfileExtension}" Width="140"/>
                <DataGridTextColumn Header="User Name" Binding="{Binding UserName}" Width="220"/>
                <DataGridTextColumn Header="Email" Binding="{Binding UserEmail}" Width="260"/>
                <DataGridTextColumn Header="State" Binding="{Binding UserState}" Width="120"/>
                <DataGridTextColumn Header="UserId" Binding="{Binding UserId}" Width="*"/>
              </DataGrid.Columns>
            </DataGrid>
          </Grid>
        </TabItem>

        <TabItem Header="Discrepancies">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
              <Button x:Name="BtnDiscrepancies" Padding="12,6" MinWidth="170" Content="Refresh Discrepancies"/>
              <Button x:Name="BtnDiscrepanciesExport" Margin="10,0,0,0" Padding="12,6" MinWidth="140" Content="Export CSV"/>
            </StackPanel>

            <TextBlock x:Name="TxtDiscrepanciesSummary" Grid.Row="1" Margin="0,10,0,10" Foreground="#374151" TextWrapping="Wrap"/>

            <DataGrid x:Name="GridDiscrepancies" Grid.Row="2" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Issue" Binding="{Binding Issue}" Width="150"/>
                <DataGridTextColumn Header="Profile Extension" Binding="{Binding ProfileExtension}" Width="140"/>
                <DataGridTextColumn Header="User Name" Binding="{Binding UserName}" Width="220"/>
                <DataGridTextColumn Header="Email" Binding="{Binding UserEmail}" Width="240"/>
                <DataGridTextColumn Header="Owner Type" Binding="{Binding ExtensionOwnerType}" Width="140"/>
                <DataGridTextColumn Header="Owner Id" Binding="{Binding ExtensionOwnerId}" Width="220"/>
                <DataGridTextColumn Header="Extension Id" Binding="{Binding ExtensionId}" Width="*"/>
              </DataGrid.Columns>
            </DataGrid>
          </Grid>
        </TabItem>

        <TabItem Header="Duplicates (Users)">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
              <Button x:Name="BtnDupUsers" Padding="12,6" MinWidth="190" Content="Refresh User Duplicates"/>
              <Button x:Name="BtnDupUsersExport" Margin="10,0,0,0" Padding="12,6" MinWidth="140" Content="Export CSV"/>
            </StackPanel>

            <TextBlock x:Name="TxtDupUsersSummary" Grid.Row="1" Margin="0,10,0,10" Foreground="#374151" TextWrapping="Wrap"/>

            <DataGrid x:Name="GridDupUsers" Grid.Row="2" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Profile Extension" Binding="{Binding ProfileExtension}" Width="160"/>
                <DataGridTextColumn Header="User Name" Binding="{Binding UserName}" Width="240"/>
                <DataGridTextColumn Header="Email" Binding="{Binding UserEmail}" Width="260"/>
                <DataGridTextColumn Header="State" Binding="{Binding UserState}" Width="120"/>
                <DataGridTextColumn Header="UserId" Binding="{Binding UserId}" Width="*"/>
              </DataGrid.Columns>
            </DataGrid>
          </Grid>
        </TabItem>

        <TabItem Header="Duplicates (Extensions)">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
              <Button x:Name="BtnDupExts" Padding="12,6" MinWidth="215" Content="Refresh Extension Duplicates"/>
              <Button x:Name="BtnDupExtsExport" Margin="10,0,0,0" Padding="12,6" MinWidth="140" Content="Export CSV"/>
            </StackPanel>

            <TextBlock x:Name="TxtDupExtsSummary" Grid.Row="1" Margin="0,10,0,10" Foreground="#374151" TextWrapping="Wrap"/>

            <DataGrid x:Name="GridDupExts" Grid.Row="2" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Extension Number" Binding="{Binding ExtensionNumber}" Width="170"/>
                <DataGridTextColumn Header="Owner Type" Binding="{Binding OwnerType}" Width="140"/>
                <DataGridTextColumn Header="Owner Id" Binding="{Binding OwnerId}" Width="220"/>
                <DataGridTextColumn Header="Extension Pool Id" Binding="{Binding ExtensionPoolId}" Width="220"/>
                <DataGridTextColumn Header="Extension Id" Binding="{Binding ExtensionId}" Width="*"/>
              </DataGrid.Columns>
            </DataGrid>
          </Grid>
        </TabItem>

        <TabItem Header="Log">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
              <Button x:Name="BtnClearLogView" Padding="12,6" MinWidth="120" Content="Clear View"/>
              <CheckBox x:Name="ChkLogAutoScroll" Margin="12,0,0,0" VerticalAlignment="Center" Content="Auto-scroll" IsChecked="True"/>
            </StackPanel>

            <TextBox
              x:Name="TxtLogLive"
              Grid.Row="1"
              Margin="0,10,0,0"
              FontFamily="Consolas"
              FontSize="12"
              IsReadOnly="True"
              TextWrapping="NoWrap"
              VerticalScrollBarVisibility="Auto"
              HorizontalScrollBarVisibility="Auto"
              AcceptsReturn="True"/>
          </Grid>
        </TabItem>

        <TabItem Header="Patch Missing">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Background="#F9FAFB" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="4" Padding="10">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="140"/>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="120"/>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="140"/>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <CheckBox x:Name="ChkWhatIf" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Content="WhatIf" IsChecked="True"/>
                <TextBlock Grid.Row="0" Grid.Column="2" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="#4B5563" Text="Sleep (ms)"/>
                <TextBox x:Name="TxtSleepMs" Grid.Row="0" Grid.Column="3" Margin="10,0,0,0" Height="26" Text="150"/>
                <TextBlock Grid.Row="0" Grid.Column="4" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="#4B5563" Text="Max updates (0=all)"/>
                <TextBox x:Name="TxtMaxUpdates" Grid.Row="0" Grid.Column="5" Margin="10,0,0,0" Height="26" Text="0"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,10,0,0" VerticalAlignment="Center" Foreground="#4B5563" Text="Confirm"/>
                <TextBox x:Name="TxtConfirmPatch" Grid.Row="1" Grid.Column="1" Margin="10,10,0,0" Height="26"/>
                <TextBlock Grid.Row="1" Grid.Column="2" Grid.ColumnSpan="5" Margin="12,10,0,0" VerticalAlignment="Center" Foreground="#6B7280" Text="For real changes, uncheck WhatIf and type PATCH."/>

                <Button x:Name="BtnRunPatch" Grid.Row="0" Grid.RowSpan="2" Grid.Column="7" Margin="12,0,0,0" Padding="14,8" MinWidth="160" Content="Run Patch"/>
              </Grid>
            </Border>

            <TextBox x:Name="TxtPatchSummary" Grid.Row="1" Margin="0,10,0,10" Height="120" IsReadOnly="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>

            <TabControl Grid.Row="2" Background="White" BorderThickness="0">
              <TabItem Header="Updated">
                <DataGrid x:Name="GridPatchUpdated" AutoGenerateColumns="True" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None"/>
              </TabItem>
              <TabItem Header="Skipped">
                <DataGrid x:Name="GridPatchSkipped" AutoGenerateColumns="True" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None"/>
              </TabItem>
              <TabItem Header="Failed">
                <DataGrid x:Name="GridPatchFailed" AutoGenerateColumns="True" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None"/>
              </TabItem>
            </TabControl>
          </Grid>
        </TabItem>
      </TabControl>
    </Border>

    <StatusBar Grid.Row="2" Background="White" BorderBrush="#DADDE2" BorderThickness="1" Padding="6">
      <StatusBarItem>
        <TextBlock x:Name="TxtStatus" Text="Ready" Foreground="#374151"/>
      </StatusBarItem>
      <StatusBarItem HorizontalAlignment="Right">
        <StackPanel Orientation="Horizontal">
          <ProgressBar x:Name="Progress" Width="180" Height="12" Margin="0,0,8,0" IsIndeterminate="True" Visibility="Collapsed"/>
          <TextBlock x:Name="TxtLogPath" Foreground="#6B7280"/>
        </StackPanel>
      </StatusBarItem>
    </StatusBar>
  </Grid>
</Window>
